<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欺诈检测系统 - 风险评估</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #1f1f1f;
            min-height: 100vh;
        }

        .header {
            background: #ffffff;
            border-bottom: 1px solid #e5e5e5;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .header h1 {
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .nav-links {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #1f1f1f;
            text-decoration: none;
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .nav-links a:hover {
            background: #efefef;
        }

        .nav-links a.active {
            background: #111111;
            color: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem 3rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: #ffffff;
            border-radius: 14px;
            padding: 1.75rem;
            border: 1px solid #e9e9e9;
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.05);
        }

        .card h2 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #3b3b3b;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d5d5d5;
            border-radius: 10px;
            font-size: 0.95rem;
            background: #fcfcfc;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #111111;
            box-shadow: 0 0 0 3px rgba(17, 17, 17, 0.08);
        }

        textarea.form-control {
            min-height: 130px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        }

        .btn {
            padding: 0.6rem 1.4rem;
            border-radius: 999px;
            border: 1px solid #d0d0d0;
            background: #ffffff;
            color: #1f1f1f;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #f0f0f0;
        }

        .btn-primary {
            background: #111111;
            color: #ffffff;
            border-color: #111111;
        }

        .btn-primary:hover {
            background: #2d2d2d;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .result-card {
            display: none;
            margin-top: 2rem;
        }

        .risk-score {
            text-align: center;
            padding: 2rem 1.5rem;
            border-radius: 14px;
            border: 1px dashed #d5d5d5;
            background: #f9f9f9;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .score-label {
            font-size: 1rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #555555;
        }

        .analysis-section {
            margin-top: 2rem;
            display: grid;
            gap: 1.5rem;
        }

        .analysis-block {
            background: #fafafa;
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid #e6e6e6;
        }

        .analysis-block h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
        }

        .feature-list {
            list-style: none;
            display: grid;
            gap: 0.6rem;
        }

        .feature-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .feature-list span:last-child {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            color: #444444;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.65rem;
            border-radius: 999px;
            background: #ededed;
            font-size: 0.75rem;
            color: #3a3a3a;
            letter-spacing: 0.08em;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: #efefef;
            border-radius: 999px;
            padding: 0.35rem 0.75rem;
            font-size: 0.8rem;
            color: #3c3c3c;
        }

        .log-area {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            background: #111111;
            color: #f5f5f5;
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid #1f1f1f;
            min-height: 180px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 0.75rem;
            opacity: 0.85;
        }

        .log-entry strong {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <h1>🛡️ 欺诈检测系统</h1>
                <nav class="nav-links">
                    <a href="dashboard.html">控制面板</a>
                    <a href="fraud-detection.html" class="active">欺诈检测</a>
                    <a href="monitoring.html">监控中心</a>
                    <a href="index.html">配置管理</a>
                    <a href="batch-process.html">批量处理</a>
                </nav>
            </div>
            <div>
                <button class="btn" onclick="resetForm()">重置</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="grid">
            <section class="card">
                <h2>实时风险评估</h2>
                <form id="riskForm" onsubmit="event.preventDefault(); evaluateRisk();">
                    <div class="form-group">
                        <label for="transactionId">交易编号</label>
                        <input type="text" id="transactionId" class="form-control" placeholder="请输入交易编号">
                    </div>

                    <div class="form-group">
                        <label for="amount">交易金额 (¥)</label>
                        <input type="number" id="amount" class="form-control" placeholder="例如 12800">
                    </div>

                    <div class="form-group">
                        <label for="channel">交易渠道</label>
                        <select id="channel" class="form-control">
                            <option value="">请选择渠道</option>
                            <option value="online">线上支付</option>
                            <option value="mobile">移动端</option>
                            <option value="offline">线下柜台</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="features">结构化特征 (JSON)</label>
                        <textarea id="features" class="form-control" placeholder='{"ip_risk":0.4,"device_trust":0.8}'></textarea>
                    </div>

                    <div class="form-group">
                        <label for="description">业务描述</label>
                        <textarea id="description" class="form-control" placeholder="用于模型决策的补充信息"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">开始评估</button>
                        <button type="button" class="btn" onclick="autoFill()">一键填充示例</button>
                    </div>
                </form>
            </section>

            <section class="card">
                <h2>评估结果</h2>
                <div id="resultPlaceholder" style="color:#888; font-size:0.9rem;">
                    提交交易信息后，将在此展示风险分数与模型解释。
                </div>
                <div id="resultCard" class="result-card">
                    <div class="risk-score" id="riskScoreDisplay">
                        <div class="score-number" id="scoreNumber">0.00</div>
                        <div class="score-label" id="scoreLabel">风险等级</div>
                    </div>

                    <div class="analysis-section">
                        <div class="analysis-block">
                            <h3>关键信号</h3>
                            <div class="tags" id="keySignals"></div>
                        </div>

                        <div class="analysis-block">
                            <h3>特征贡献</h3>
                            <ul class="feature-list" id="featureContribution"></ul>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <section class="card" style="margin-top: 2rem;">
            <h2>推理日志</h2>
            <div class="log-area" id="logArea">
                <div class="log-entry"><strong>[INFO]</strong> 等待评估请求...</div>
            </div>
        </section>
    </main>

    <script>
        function evaluateRisk() {
            const transactionId = document.getElementById('transactionId').value || 'T' + Date.now();
            const amount = Number(document.getElementById('amount').value || 0);
            const channel = document.getElementById('channel').value || 'unknown';
            const featuresInput = document.getElementById('features').value;

            let featureData = {};
            try {
                featureData = featuresInput ? JSON.parse(featuresInput) : {};
            } catch (error) {
                alert('特征输入格式错误，请提供有效的 JSON');
                return;
            }

            appendLog(`[INFO] 提交交易 ${transactionId} 进行风险评估`);

            setTimeout(() => {
                const riskScore = Math.random();
                const level = riskScore > 0.7 ? '高风险' : riskScore > 0.4 ? '中风险' : '低风险';

                document.getElementById('resultPlaceholder').style.display = 'none';
                document.getElementById('resultCard').style.display = 'block';
                document.getElementById('scoreNumber').textContent = riskScore.toFixed(2);
                document.getElementById('scoreLabel').textContent = level;

                updateRiskStyle(riskScore);
                renderSignals(level, amount, channel);
                renderContribution(featureData);

                appendLog(`[RESULT] 风险分数 ${riskScore.toFixed(2)} (${level})`);
            }, 600);
        }

        function updateRiskStyle(score) {
            const scoreDisplay = document.getElementById('riskScoreDisplay');

            if (score > 0.7) {
                scoreDisplay.style.background = '#f2f2f2';
                scoreDisplay.style.borderColor = '#1f1f1f';
            } else if (score > 0.4) {
                scoreDisplay.style.background = '#fafafa';
                scoreDisplay.style.borderColor = '#5a5a5a';
            } else {
                scoreDisplay.style.background = '#ffffff';
                scoreDisplay.style.borderColor = '#d0d0d0';
            }
        }

        function renderSignals(level, amount, channel) {
            const container = document.getElementById('keySignals');
            container.innerHTML = '';

            const signals = [
                `${level}提醒`,
                `渠道: ${channel}`,
                amount > 10000 ? '大额交易' : '普通金额',
                '设备可信度 82%'
            ];

            signals.forEach(text => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.textContent = text;
                container.appendChild(tag);
            });
        }

        function renderContribution(features) {
            const list = document.getElementById('featureContribution');
            list.innerHTML = '';

            const entries = Object.keys(features).length
                ? Object.entries(features)
                : [['ip_risk', Math.random().toFixed(2)], ['device_trust', Math.random().toFixed(2)], ['txn_velocity', Math.random().toFixed(2)]];

            entries.forEach(([name, value]) => {
                const item = document.createElement('li');
                const label = document.createElement('span');
                label.textContent = name;
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.textContent = value;
                item.appendChild(label);
                item.appendChild(badge);
                list.appendChild(item);
            });
        }

        function appendLog(message) {
            const area = document.getElementById('logArea');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `${new Date().toLocaleTimeString()} ${message}`;
            area.appendChild(entry);
            area.scrollTop = area.scrollHeight;
        }

        function autoFill() {
            document.getElementById('transactionId').value = 'TX' + Math.floor(Math.random() * 1000000);
            document.getElementById('amount').value = (Math.random() * 20000 + 1000).toFixed(2);
            document.getElementById('channel').value = ['online', 'mobile', 'offline'][Math.floor(Math.random() * 3)];
            document.getElementById('features').value = JSON.stringify({
                ip_risk: Math.random().toFixed(2),
                device_trust: Math.random().toFixed(2),
                velocity: Math.random().toFixed(2)
            }, null, 2);
            document.getElementById('description').value = '系统自动填充的示例交易信息。';
        }

        function resetForm() {
            document.getElementById('riskForm').reset();
            document.getElementById('resultCard').style.display = 'none';
            document.getElementById('resultPlaceholder').style.display = 'block';
            document.getElementById('keySignals').innerHTML = '';
            document.getElementById('featureContribution').innerHTML = '';
            appendLog('[INFO] 表单已重置');
        }
    </script>
</body>
</html>
